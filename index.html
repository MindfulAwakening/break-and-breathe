<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Break & Breathe — v3.1.0</title>
<meta name="theme-color" content="#0b1324" />
<link rel="manifest" href="manifest.webmanifest" />
<style>
  :root{--bg:#0b1324;--card:#121c34;--accent:#8ad1ff;--text:#e8f0ff;--muted:#a9b8d6;--ring:rgba(138,209,255,.25);}
  body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--text);padding:20px}
  .card{background:var(--card);padding:16px;border-radius:12px}
  .section{margin-top:12px;padding:12px;background:rgba(255,255,255,.05);border-radius:8px}
  label{font-size:13px;display:block;margin:6px 0}
  select,input[type="text"],input[type="password"],input[type="range"]{width:100%;padding:6px;border-radius:6px;border:1px solid #444;background:#222;color:#eee}
  .row{display:flex;gap:6px;margin-top:6px}
  .btn{flex:1;padding:6px 10px;border:none;border-radius:6px;cursor:pointer;background:#333;color:#eee}
  .btn.ghost{background:#222}
  .muted{color:#aaa;font-size:12px;margin-top:4px}
</style>
</head>
<body>
<div class="card">
  <h2>🧘 Break & Breathe v3.1</h2>

  <div class="section">
    <h3>Voice Settings</h3>
    <label for="voiceSource">Voice Source</label>
    <select id="voiceSource">
      <option value="browser">Browser TTS</option>
      <option value="elA">ElevenLabs A</option>
      <option value="elB">ElevenLabs B</option>
    </select>

    <div id="browserBlock">
      <label for="voiceSelect">Browser Voice</label>
      <select id="voiceSelect"></select>
      <div class="muted" id="voiceStatus">Loading voices…</div>
    </div>

    <div id="elCreds" style="display:none">
      <label for="elApiKey">ElevenLabs API Key</label>
      <input id="elApiKey" type="password" placeholder="Paste your API key" />

      <label for="proxyUrl">Proxy URL (optional)</label>
      <input id="proxyUrl" type="text" placeholder="https://your-app.vercel.app/api/tts" />

      <label for="elVoiceA">Voice A ID</label>
      <input id="elVoiceA" type="text" placeholder="Voice A ID" />

      <label for="elVoiceB">Voice B ID</label>
      <input id="elVoiceB" type="text" placeholder="Voice B ID" />

      <div class="row">
        <button id="saveCreds" class="btn">💾 Save</button>
        <button id="checkCreds" class="btn ghost">✅ Check Credentials</button>
      </div>
      <div id="credStatus" class="muted">—</div>
    </div>

    <div class="section">
      <label>Rate (speed): <span id="rateLbl">1.0</span></label>
      <input id="voiceRate" type="range" min="0.6" max="1.4" step="0.05" value="1.0" />
      <label>Pitch: <span id="pitchLbl">1.0</span></label>
      <input id="voicePitch" type="range" min="0.7" max="1.3" step="0.05" value="1.0" />
      <label>Volume: <span id="volLbl">1.0</span></label>
      <input id="voiceVol" type="range" min="0.2" max="1.0" step="0.05" value="1.0" />
    </div>
  </div>
</div>

<script>
const $=id=>document.getElementById(id);
const LS={get:k=>localStorage.getItem(k),set:(k,v)=>localStorage.setItem(k,v)};

// show/hide UI
$('voiceSource').addEventListener('change',()=>{
  if($('voiceSource').value==='browser'){
    $('browserBlock').style.display='block';
    $('elCreds').style.display='none';
  } else {
    $('browserBlock').style.display='none';
    $('elCreds').style.display='block';
  }
});

// live slider labels
['voiceRate','voicePitch','voiceVol'].forEach(id=>{
  $(id).addEventListener('input',()=>{
    if(id==='voiceRate') $('rateLbl').textContent=$(id).value;
    if(id==='voicePitch') $('pitchLbl').textContent=$(id).value;
    if(id==='voiceVol') $('volLbl').textContent=$(id).value;
  });
});

// save creds
$('saveCreds').addEventListener('click',()=>{
  LS.set('EL_API_KEY',$('elApiKey').value);
  LS.set('EL_VOICE_A',$('elVoiceA').value);
  LS.set('EL_VOICE_B',$('elVoiceB').value);
  LS.set('EL_PROXY_URL',$('proxyUrl').value);
  $('credStatus').textContent='Saved locally ✅';
});

// check creds
$('checkCreds').addEventListener('click',async()=>{
  const proxy=LS.get('EL_PROXY_URL')||$('proxyUrl').value;
  const key=LS.get('EL_API_KEY')||$('elApiKey').value;
  const voiceId=LS.get('EL_VOICE_A')||$('elVoiceA').value;
  try{
    let res;
    if(proxy){
      res=await fetch(proxy,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text:'Hello test',voiceId})});
    }else{
      res=await fetch('https://api.elevenlabs.io/v1/voices',{headers:{'xi-api-key':key}});
    }
    $('credStatus').textContent=res.ok?'Credentials OK ✅':'Error ❌ '+res.status;
  }catch(e){
    $('credStatus').textContent='Error ❌ '+e;
  }
});

// load browser voices
function loadVoices(){
  if(!('speechSynthesis' in window)){ $('voiceStatus').textContent='Not supported'; return; }
  const voices=window.speechSynthesis.getVoices();
  $('voiceSelect').innerHTML='';
  voices.forEach(v=>{
    const opt=document.createElement('option');
    opt.value=v.name; opt.textContent=v.name+' ('+v.lang+')';
    $('voiceSelect').appendChild(opt);
  });
  $('voiceStatus').textContent=voices.length?'Loaded '+voices.length+' voices':'No voices';
}
speechSynthesis.onvoiceschanged=loadVoices;
loadVoices();
</script>
</body>
</html>